

#include <stdint.h>
#include <stdio.h>

#include "hal.h"

#include "NTT_params.h"
#include "ring.h"

#include "tools.h"
#include "naive_mult.h"
#include "gen_table.h"
#include "ntt_c.h"

struct compress_profile profile;

int32_t const_buff[8] = {
Qprime, Q, RmodQ, RmodQhi
};

uint64_t oldcount, newcount;
char out[128];

#define ITERATIONS 10000

extern void __asm_NTT(int32_t*, int32_t*, int32_t*);
extern void __asm_iNTT(int32_t*, int32_t*, int32_t*);
extern void __asm_point_mul_pre(int32_t*, int32_t*, int32_t*, int32_t*);
extern void __asm_extend(int32_t*, int32_t*, int32_t*);
extern void __asm_point_montmul(int32_t*, int32_t*, int32_t*, int32_t*);

extern void __asm_NTT_fast(int32_t*, int32_t*, int32_t*);
extern void __asm_iNTT_fast(int32_t*, int32_t*, int32_t*);
extern void __asm_point_mul_pre_fast(int32_t*, int32_t*, int32_t*, int32_t*);
extern void __asm_point_montmul_fast(int32_t*, int32_t*, int32_t*, int32_t*);

extern void __asm_iNTT_negacyclic(int32_t*, int32_t*, int32_t*);
extern void __asm_iNTT_negacyclic_scale(int32_t*, int32_t*, int32_t*, int32_t*);

extern void __asm_InnerProd_L(int32_t*, int32_t*, int32_t*);
extern void __asm_InnerProd_L_fast(int32_t*, int32_t*, int32_t*);

static
int32_t streamlined_twiddle_table[N << 1];

// ================

static
int32_t streamlined_CT_table[N << 2] = {
-3572223, -1830765815, 3765607, 1929875198, 3761513, 1927777021, -3201494, -1640767044, -2883726, -1477910808, -3145678, -1612161320, -3201430, -1640734244, -601683, -308362795, 3542485, 1815525077, 2682288, 1374673747, 2129892, 1091570561, 3764867, 1929495947, -1005239, -515185417, 557458, 285697463, -1221177, -625853735, -3370349, -1727305304, -4063053, -2082316400, 2663378, 1364982364, -1674615, -858240904, -3524442, -1806278032, -434125, -222489248, 676590, 346752664, -1335936, -684667771, -3227876, -1654287830, 1714295, 878576921, 2453983, 1257667337, 1460718, 748618600, -642628, -329347125, -3585098, -1837364258, 2815639, 1443016191, 2283733, 1170414139, 3602218, 1846138265, 3182878, 1631226336, 2740543, 1404529459, -3586446, -1838055109, -3110818, -1594295555, 2101410, 1076973524, 3704823, 1898723372, 1159875, 594436433, 394148, 202001019, 928749, 475984260, 1095468, 561427818, -3506380, -1797021249, 2071829, 1061813248, -4018989, -2059733581, 3241972, 1661512036, 2156050, 1104976547, 3415069, 1750224323, 1759347, 901666090, -817536, -418987550, -3574466, -1831915353, 3756790, 1925356481, -1935799, -992097815, -1716988, -879957084, -3950053, -2024403852, -2897314, -1484874664, 3192354, 1636082790, 556856, 285388938, 3870317, 1983539117, 2917338, 1495136972, 1853806, 950076368, 3345963, 1714807468, 1858416, 952438995, 3073009, 1574918427, 1277625, 654783359, -2635473, -1350681039, 3852015, 1974159335, 4183372, 2143979939, -3222807, -1651689966, -3121440, -1599739335, -274060, -140455867, 2508980, 1285853323, 2028118, 1039411342, 1937570, 993005454, -3815725, -1955560694, 2811291, 1440787840, -2983781, -1529189038, -1109516, -568627424, 4158088, 2131021878, 1528066, 783134478, 482649, 247357819, 1148858, 588790216, -2962264, -1518161567, -565603, -289871779, 169688, 86965173, 2462444, 1262003603, -3334383, -1708872713, -4166425, -2135294594, -3488383, -1787797779, 1987814, 1018755525, -3197248, -1638590967, 1736313, 889861155, 235407, 120646188, -3250154, -1665705315, 3258457, 1669960606, -2579253, -1321868265, 1787943, 916321552, -2391089, -1225434135, -2254727, -1155548552, 3482206, 1784632064, -4182915, -2143745726, -1300016, -666258756, -2362063, -1210558298, -1317678, -675310538, 2461387, 1261461890, 3035980, 1555941048, 621164, 318346816, 3901472, 1999506068, -1226661, -628664287, 2925816, 1499481951, 3374250, 1729304568, 1356448, 695180180, -2775755, -1422575624, 2683270, 1375177022, -2778788, -1424130038, -3467665, -1777179795, 2312838, 1185330464, -653275, -334803717, -459163, -235321234, 348812, 178766299, -327848, -168022240, 1011223, 518252220, -2354215, -1206536194, -3818627, -1957047970, -1922253, -985155484, -2236726, -1146323031, 1744507, 894060583, 1753, 898413, -1935420, -991903578, -2659525, -1363007700, -1455890, -746144248, 2660408, 1363460238, -1780227, -912367099, -59148, -30313375, 2772600, 1420958686, 1182243, 605900043, 87208, 44694137, 636927, 326425360, -3965306, -2032221021, -3956745, -2027833504, -2296397, -1176904444, -3284915, -1683520342, -3716946, -1904936414, -27812, -14253662, 822541, 421552614, 1009365, 517299994, -2454145, -1257750362, -1979497, -1014493059, 1596822, 818371958, -3956944, -2027935492, -3759465, -1926727420, -1685153, -863641633, -3410568, -1747917558, 2678278, 1372618620, -3768948, -1931587462, -3551006, -1819892093, 635956, 325927722, -250446, -128353682, -2455377, -1258381762, -4146264, -2124962073, -1772588, -908452108, 2192938, 1123881663, -1727088, -885133339, 2387513, 1223601433, -3611750, -1851023419, -268456, -137583815, -3180456, -1629985060, 3747250, 1920467227, 2296099, 1176751719, 1239911, 635454918, -3838479, -1967222129, 3195676, 1637785316, 2642980, 1354528380, 1254190, 642772911, -12417, -6363718, 2998219, 1536588520, 141835, 72690498, -89301, -45766801, 2513018, 1287922800, -1354892, -694382729, 613238, 314284737, -1310261, -671509323, -2218467, -1136965286, -458740, -235104446, -1921994, -985022747, 4040196, 2070602178, -3472069, -1779436847, 2039144, 1045062172, -1879878, -963438279, -818761, -419615363, -2178965, -1116720494, -1623354, -831969619, 2105286, 1078959975, -2374402, -1216882040, -2033807, -1042326957, 586241, 300448763, -1179613, -604552167, 527981, 270590488, -2743411, -1405999311, -1476985, -756955444, 1994046, 1021949428, 2491325, 1276805128, -1393159, -713994583, 507927, 260312805, -1187885, -608791570, -724804, -371462360, -1834526, -940195359, -3033742, -1554794072, -338420, -173440395, 2647994, 1357098057, 3009748, 1542497137, -2612853, -1339088280, 4148469, 2126092136, 749577, 384158533, -4022750, -2061661095, 3980599, 2040058690, 2569011, 1316619236, -1615530, -827959816, 1723229, 883155599, 1665318, 853476187, 2028038, 1039370342, 1163598, 596344473, -3369273, -1726753853, 3994671, 2047270596, -11879, -6087993, -1370517, -702390549, 3020393, 1547952704, 3363542, 1723816713, 214880, 110126092, 545376, 279505433, -770441, -394851342, 3105558, 1591599803, -1103344, -565464272, 508145, 260424530, -553718, -283780712, 860144, 440824168, 3430436, 1758099917, 140244, 71875110, -1514152, -776003547, -2185084, -1119856484, 3123762, 1600929361, 2358373, 1208667171, -2193087, -1123958025, -3014420, -1544891539, -1716814, -879867909, 2926054, 1499603926, -392707, -201262505, -303005, -155290192, 3531229, 1809756372, -3974485, -2036925262, -3773731, -1934038751, 1900052, 973777462, -781875, -400711272, 1054478, 540420426, -731434, -374860238, -2092185289, 1495968761, 280296181, 1917991850, -342037329, 799381767, -235910290, -645040213, -1063599046, 365880718, 2035232217, -619671442, -1219524352, 2058473342, -945691705, 663901254, 865536479, 1206184106, -681226234, -1236385244, -2105840013, -1207115832, -1946903306, -1356364157, -149204291, 842148390, -871926528, -186119655, -909703186, 1928163446, -2128423570, 103703437, -1249150098, -239832263, -2105367577, -964992180, -1446016101, 1945472123, -1276546902, -1395804140, -844577438, 945398776, -2127589091, 531374281, -353673949, -869423663, 1176805470, 1817885142, -913514834, -25307784, 501792259, -529290454, 313277279, 1640949494, 85937635, 1093401725, -757930398, -1892596429, -2110178347, 864453434, -2053169382, 16801302, 1745319356, 1123718688, -1717427386, 286025976, 23516166, -832856757, 1980381849, 1334262576, 226939312, 342377448, -1011168128, 1466944836, 311428175, 693282903, -516477847, 1592854916, 746342206, 248610370, -1002739703, 1491548957, 1713682141, 2089501656, -1136015064, 1907346191, 293115968, -101796422, 1510036988, 800488768, 780897264, 778223187, 569674392, -99406633, 459873335, -537920449, -872335207, -395567818, -708338222, 2048578497, 2079661947, 675747701, 2113252873, 711242456, -670536916, -53072494, 332033078, -1631597386, 594275738, -376108176, 124060568, -843415291, -1880847302, -1862372229, -1658274595, 537085586, -688233303, -532543807, 458284798, -1352046341, 253852161, 1250322181, 1790458804, -1512098687, -157550805, 859523692, 830082889, 216073255, -786245077, 775987660, 1209671671, 1481958024, 388300679, 1435768410, -307465404, 1337638929, 1394542694, 1739155851, 1602407064, 895551960, -679827190, -519374596, 173681244, -1182601399, -1910619297, 59336787, -1536175763, -1311720244, 9906187, 781957777, 1404082145, -1961806024, -2103556902, -37020468, -2007069204, -2126641537, -317792959, 339729871, -1555145728, 1851066469, -431035042, -1862311241, -1901060893, 663055628, 1795469569, 1055920519, -987300033, 814451842, -1358849780, -626391348, 71161635, 2110629999, -613286460, -776960386, 212886360, 1730168131, 340060570, -1812471600, -1553999458, -1856436961, -1661092923, -907308720, -1477288891, -1196944236, -756797654, -1312064645, 653870424, 101422810, -1141071460, -684058921, -3652178, -1871742787, 1205123781, -848837546, 966946782, 1639400205, 834690506, -1717488358, 1399741669, 108665466, -1551898565, -779728401, -1884398720, 612491824, 1659112547, -107634827, -372698705, -2029684656, 1898692236, -1876993354, 1168757325, 1988174684, 985737906, -1615042598, 1647156566, -1940112906, -1516738208, 60100413, 252741745, 681233506, 1194604583, -1944963723, -1612350868, -1696788466, 1805129043, 1711437778, -2138638656, -836565210, 368211361, -270081063, -1612722353, -1887174687, 1170557402, -1384252380, -2078160355, 93818841, -1616162102, 644919776, 1943545330, -364599979, 1777890941, 636800744, 247019924, 2043765093, -1954375340, -890817481, 1982766425, -1738608501, -435712456, 35479380, 1190347292, 168140115, -1561543793, -1427944579, 1079410813, -852277961, 824875030, 1842010587, 576413096, -940785247, -1551437809, -543590754, 508081466, -1601036473, -1419421956, -1604886377, -1945353964, -562325719, -235130793, -245547667, 1135705202, -2066150599, 625854582, -1371806307, 880887155, 483477528, 487638296, 806732048, -257918976, 960400689, -705707649, -898219012, -548039768, -1697741204, -1287058825, 1806765420, -403787151, -782657341, 1824409120, -1292416403, 599674396, -1904260939, -531109483, -1610897494, -1092707563, -1667344804, 1407283947, -320881130, 787109783, -332825465, 1093497431, 2072152491, 363648701, 1686521032, -1322724942, 707734390, 208195362, -673970350, -10360127, -1014602222, -857066048, -1160051893, 1745240491, 1083300341, -1626077932, -141980043, -1400886854, -695573268, -325512550, 678403479, 828091359, -804586721, 1784423410, -310273396, 1563999462, -1608491305, -270820224, -1356527132, 380504698, 1735292110, 1140117797, 195306225, -1052437261, 1791333007, -1140879183, -585516876, -451540251, 513662266, 888370726, 23843570, 202438659, 670684197, -1236669309, 1861610141, -1364234391, 908960508, -771157186, -81396343, 96653591, -2004600835, -1964172231, -1616761011, 569460832, -208856224, -1186886308, 1605615665, -1938405080, -1295986994, 1936387931, 262197269, 1252436992, 1924366843, 1806277086, -1995156990, 392530287, -691522977, -1385231593, -1262179903, -352883428, -464281312, -2092676385, 1244281851, -999626090, -1207690345, 587684231, 540708964, -534746343, 820177497, 529277743, 672129961, 1768890775, 319179116, -768512926, 1273788038, 1038758769, -211631414, -1661574419, -1154075625, 1487382861, 2075140881, -870111734, 743963046, 1980431910, 1359918860, -776415087, 1518894442, -9957794, -808406387, -1711941528, -1197436749, -1694162896, -675814839, -688527634, -683388570, 333042712, -1114159530, -292218133, 561937244, 716584812, -2117164891, 158630396, -306232843, -1113795008, 410232505, 1677277202, 611824035, 180084969, 2099310402, 1318737123, 1543473963, -120357667, -1553813659, 35358734, 941497111, -1475328421, -192202523, 1412908263, -1733384071, -1938238772, -1210754073, 994814629, -1258185475, -1392549761, -717776836, -720413419, 155002167, -348401466, 1832726129, 828040832, -830481830, 1315584429, -72283060, 223833131, -1249541643, -1575561022, -21845843, -696122617, -280853309, -1399273084, 131484547, -590034676, -1745313031, 1353105995, 1977666375, 1385143279, 1216918940, 27548586, 1233760217, 17512855, 385411084, 608709362, -1568804296, 333716040, -769078642, 253483195, 1061226948, 1703344678, 1086514744, -1821913307, -1723445663, -1896138148, -1109002750, -1793637318, -116891098, -512891647, -864183346, 35099368, 808571925, 1777420328, 395611380, 2004795205, 961216077, 1075667428, 1524202922, -1031028074, -121351389, -1153349463, 1613393884, -1219373093, 2135993645, 1460690722, 1280310118, 915456060, 1020186939, 1031324887, 273468178, -1074076603, -708904429, 1585226912, 680651305, 386164594, 341023935, -1309888, -671318160, 1554202473, 1960482236, 841902786, 1978808226, 336114896, 460336084, -103958239, -1739034388, 1408696776, 403194336,
};

static
int32_t streamlined_CT_inv_table[N << 1] = {
1, 513, 1, 513, 3572223, 1830765815, 1, 513, -3761513, -1927777021, 3572223, 1830765815, -3765607, -1929875198, 1, 513, 3201430, 1640734244, -3761513, -1927777021, 2883726, 1477910808, 3572223, 1830765815, 3145678, 1612161320, -3765607, -1929875198, 3201494, 1640767044, 1, 513, 1221177, 625853735, 3201430, 1640734244, -2129892, -1091570561, -3761513, -1927777021, 1005239, 515185417, 2883726, 1477910808, -3542485, -1815525077, 3572223, 1830765815, -557458, -285697463, 3145678, 1612161320, -2682288, -1374673747, -3765607, -1929875198, -3764867, -1929495947, 3201494, 1640767044, 601683, 308362795, 1, 513, -2283733, -1170414139, 1221177, 625853735, 1335936, 684667771, 3201430, 1640734244, -1460718, -748618600, -2129892, -1091570561, 1674615, 858240904, -3761513, -1927777021, 3585098, 1837364258, 1005239, 515185417, 434125, 222489248, 2883726, 1477910808, -1714295, -878576921, -3542485, -1815525077, 4063053, 2082316400, 3572223, 1830765815, -2815639, -1443016191, -557458, -285697463, -676590, -346752664, 3145678, 1612161320, -2453983, -1257667337, -2682288, -1374673747, -2663378, -1364982364, -3765607, -1929875198, 642628, 329347125, -3764867, -1929495947, 3524442, 1806278032, 3201494, 1640767044, 3227876, 1654287830, 601683, 308362795, 3370349, 1727305304, 1, 513, -1858416, -952438995, -2283733, -1170414139, -2156050, -1104976547, 1221177, 625853735, 3950053, 2024403852, 1335936, 684667771, -1159875, -594436433, 3201430, 1640734244, -3870317, -1983539117, -1460718, -748618600, 3506380, 1797021249, -2129892, -1091570561, 3574466, 1831915353, 1674615, 858240904, 3586446, 1838055109, -3761513, -1927777021, -1853806, -950076368, 3585098, 1837364258, 4018989, 2059733581, 1005239, 515185417, 1935799, 992097815, 434125, 222489248, -2101410, -1076973524, 2883726, 1477910808, -3192354, -1636082790, -1714295, -878576921, -928749, -475984260, -3542485, -1815525077, -1759347, -901666090, 4063053, 2082316400, -3182878, -1631226336, 3572223, 1830765815, -3345963, -1714807468, -2815639, -1443016191, -3241972, -1661512036, -557458, -285697463, 1716988, 879957084, -676590, -346752664, -3704823, -1898723372, 3145678, 1612161320, -556856, -285388938, -2453983, -1257667337, -1095468, -561427818, -2682288, -1374673747, 817536, 418987550, -2663378, -1364982364, -2740543, -1404529459, -3765607, -1929875198, -2917338, -1495136972, 642628, 329347125, -2071829, -1061813248, -3764867, -1929495947, -3756790, -1925356481, 3524442, 1806278032, 3110818, 1594295555, 3201494, 1640767044, 2897314, 1484874664, 3227876, 1654287830, -394148, -202001019, 601683, 308362795, -3415069, -1750224323, 3370349, 1727305304, -3602218, -1846138265, 1, 513, -1744507, -894060583, -1858416, -952438995, -3258457, -1669960606, -2283733, -1170414139, -3374250, -1729304568, -2156050, -1104976547, -4158088, -2131021878, 1221177, 625853735, 459163, 235321234, 3950053, 2024403852, 3334383, 1708872713, 1335936, 684667771, 2362063, 1210558298, -1159875, -594436433, 274060, 140455867, 3201430, 1640734244, 2354215, 1206536194, -3870317, -1983539117, 3197248, 1638590967, -1460718, -748618600, -621164, -318346816, 3506380, 1797021249, 3815725, 1955560694, -2129892, -1091570561, 2778788, 1424130038, 3574466, 1831915353, 2962264, 1518161567, 1674615, 858240904, 2254727, 1155548552, 3586446, 1838055109, -3852015, -1974159335, -3761513, -1927777021, 1922253, 985155484, -1853806, -950076368, -235407, -120646188, 3585098, 1837364258, 1226661, 628664287, 4018989, 2059733581, 2983781, 1529189038, 1005239, 515185417, -2312838, -1185330464, 1935799, 992097815, -169688, -86965173, 434125, 222489248, 4182915, 2143745726, -2101410, -1076973524, 3222807, 1651689966, 2883726, 1477910808, 327848, 168022240, -3192354, -1636082790, 3488383, 1787797779, -1714295, -878576921, -2461387, -1261461890, -928749, -475984260, -2028118, -1039411342, -3542485, -1815525077, 2775755, 1422575624, -1759347, -901666090, -482649, -247357819, 4063053, 2082316400, -1787943, -916321552, -3182878, -1631226336, -1277625, -654783359, 3572223, 1830765815, 2236726, 1146323031, -3345963, -1714807468, 3250154, 1665705315, -2815639, -1443016191, -2925816, -1499481951, -3241972, -1661512036, 1109516, 568627424, -557458, -285697463, 653275, 334803717, 1716988, 879957084, -2462444, -1262003603, -676590, -346752664, 1300016, 666258756, -3704823, -1898723372, 3121440, 1599739335, 3145678, 1612161320, -1011223, -518252220, -556856, -285388938, -1987814, -1018755525, -2453983, -1257667337, -3035980, -1555941048, -1095468, -561427818, -1937570, -993005454, -2682288, -1374673747, -2683270, -1375177022, 817536, 418987550, -1148858, -588790216, -2663378, -1364982364, 2391089, 1225434135, -2740543, -1404529459, 2635473, 1350681039, -3765607, -1929875198, 3818627, 1957047970, -2917338, -1495136972, -1736313, -889861155, 642628, 329347125, -3901472, -1999506068, -2071829, -1061813248, -2811291, -1440787840, -3764867, -1929495947, 3467665, 1777179795, -3756790, -1925356481, 565603, 289871779, 3524442, 1806278032, -3482206, -1784632064, 3110818, 1594295555, -4183372, -2143979939, 3201494, 1640767044, -348812, -178766299, 2897314, 1484874664, 4166425, 2135294594, 3227876, 1654287830, 1317678, 675310538, -394148, -202001019, -2508980, -1285853323, 601683, 308362795, -1356448, -695180180, -3415069, -1750224323, -1528066, -783134478, 3370349, 1727305304, 2579253, 1321868265, -3602218, -1846138265, -3073009, -1574918427, -2091667, -1071980232
};

static
int32_t last_twist_mont_table[N << 1] = {
16382, 8395782, -1644522, -842818228, -1291704, -661998852, 3608627, 1849422881, 1484049, 760575747, 2003924, 1027011907, 3213716, 1647030824, -2015586, -1032988687, -1932518, -990416301, -1196256, -613081712, 267032, 136854014, 2285286, 1171210052, 3046555, 1561360740, 1029570, 527655065, -1768240, -906223756, -1100550, -564032346, 1266235, 648945979, -2834182, -1452519487, -3606200, -1848179042, -2942135, -1507845446, -3811828, -1953563480, -2908788, -1490755094, 304300, 155953880, -128903, -66062843, 4034765, 2067818788, 456460, 233935945, 2930777, 1502024466, 1177703, 603573291, -2666911, -1366793028, -1617369, -828902304, -2252592, -1154454363, 1126940, 577557232, 1176674, 603045928, -1074967, -550921047, 71096, 36436730, 1544179, 791392398, 2701928, 1384739255, 3687395, 1889791514, -289514, -148376049, -4006320, -2053240713, -3391741, -1738268713, 3397082, 1741005978, -2082410, -1067236015, 3694227, 1893292917, 2139042, 1096259940, 2855247, 1463315308, -323453, -165769801, 3030725, 1553247858, 4165644, 2134894331, 303555, 155572067, -320128, -164065737, -3652572, -1871944712, 2928433, 1500823165, -3698525, -1895495644, -3185999, -1632825850, 2943041, 1508309771, -3942328, -2020444786, -2096158, -1074281871, -3940422, -2019467960, 867824, 444760171, -1945215, -996923519, -2711718, -1389756635, 830280, 425518855, -276802, -141861143, 100235, 51370480, 3399074, 1742026878, -3258440, -1669951893, -1871079, -958928788, 1581316, 810425126, -3345528, -1714584531, -1445654, -740898293, -1372861, -703591850, 1113100, 570464226, 1673850, 857848841, -1079464, -553225762, -4064138, -2082872463, 2521846, 1292447153, 603796, 309445708, -2672019, -1369410880, -116259, -59582787, 305893, 156770293, 167496, 85841772, -1046859, -536515685, 2055067, 1053222716, 761290, 390161451, -3417705, -1751575274, 2469628, 1265685406, -3856547, -1976481987, -3138283, -1608371379, -389020, -199372916, -2156279, -1105093910, 1944480, 996546831, 1454416, 745388822, -821436, -420986301, -602826, -308948583, -172446, -88378649, 788703, 404210625, 1425073, 730350522, -1041361, -533697958, 879039, 450507863, -3341148, -1712339779, 915972, 469436042, 626783, 321226556, -315163, -161521172, -803323, -411703381, -1578061, -808756937, 4124770, 2113946389, -3382322, -1733441471, 4071154, 2086468166, 403894, 206995848, 3724329, 1908720205, -3970566, -2034916773, 1398455, 716708785, -2642882, -1354478155, 275768, 141331218, -2165461, -1109799688, -1368491, -701352223, -3839614, -1967803817, -4022687, -2061628808, 843874, 432485786, 3662432, 1876997966, 1852187, 949246630, -524811, -268965862, 391711, 200752055, 1047178, 536679173, -3379297, -1731891158, -4151501, -2127646038, 2932929, 1503127367, -294725, -151046689, -2419159, -1239820022, 2862208, 1466882824, -4104915, -2103770693, 2741731, 1405138310, 3386239, 1735448935, 3233627, 1657235220, -3597958, -1843955014, 17070, 8748382, -1242950, -637012406, -3112889, -1595356944, 2641904, 1353976930, -3282775, -1682423591, -1311761, -672278073, -1033361, -529597954, 2819973, 1445237368, 2377574, 1218507692, 1368612, 701414235, 158541, 81252330, 2447765, 1254480609, 3017964, 1546707840, -2259509, -1157999329, 3569830, 1829539401, 131113, 67195469, 3394311, 1739585839, -825110, -422869228, 2222515, 1139039888, -1872733, -959776463, -1430472, -733117512, -794398, -407129315, -1874454, -960658477, -3165836, -1622492304, 1312863, 672842849, 2553597, 1308719554, 2229223, 1142477741, 2042594, 1046830298, 3859121, 1977801163, 255574, 130981784, 1931514, 989901751, -4067201, -2084442252, -289157, -148193086, -2677309, -1372122007, 2350535, 1204650193, 1908806, 978263891, -3483979, -1785540727, -255360, -130872109, 3747856, 1920777803, -518949, -265961584, -2715685, -1391789724, -1144116, -586359939, -2041975, -1046513061, -3643993, -1867547971, 968386, 496298239, -2399316, -1229650476, 1824826, 935224105, -854689, -438028478, -3007494, -1541341961, 672351, 344580175, 750940, 384857071, 2137363, 1095399451, -1681557, -861798682, 3938267, 2018363522, -1589698, -814720905, -1449433, -742835032, 75663, 38777320, -1783126, -913852837, -3065391, -1571014198, -914846, -468858966, 1687035, 864606159, -2982141, -1528348538, -1144268, -586437839, 4105895, 2104272943, 1728144, 885674539, -3398031, -1741492341, 3526155, 1807155945, 900767, 461643473, -13828, -7086856, 893967, 458158470, -4177747, -2141097124, -3128905, -1603565150, 3817926, 1956688708, -3568941, -1829083789, -3558813, -1823893184, -3883889, -1990494773, 2048668, 1049943226, -3412190, -1748748834, -3032856, -1554339997, -4093936, -2098143951, -3664286, -1877948142, -303269, -155425492, -173, -88663, -831827, -426311693, 104699, 53658282, 157820, 80882817, 3050122, 1563188829, 3744961, 1919294114, 2225122, 1140375976, 2621046, 1343287196, 1206210, 618183141, -2155369, -1104627534, -2883940, -1478020483, -2148141, -1100923181, -4122115, -2112585700, 1082848, 554960063, -1366638, -700402559, 2260451, 1158482104, -1753196, -898513700, -894975, -458675070, -4011446, -2055867790, 1704391, 873501116, 3835025, 1965451952, -361139, -185083892, 1400514, 717764024, 3285081, 1683605417, 3534748, 1811559861, 800379, 410194580, 2003534, 1026812032, 2888634, 1480426160, -471633, -241712114, 3073666, 1575255139, 2870122, 1470938752, 1976031, 1012716732, -739868, -379182666, 817063, 418745137, 3361238, 1722635912, 2722087, 1395070751, -868519, -445116359, -3576395, -1832903967
};

static
int32_t last_twist_table[N << 1] = {
16382, 8395782, -1644522, -842818228, -1291704, -661998852, 3608627, 1849422881, 1484049, 760575747, 2003924, 1027011907, 3213716, 1647030824, -2015586, -1032988687, -1932518, -990416301, -1196256, -613081712, 267032, 136854014, 2285286, 1171210052, 3046555, 1561360740, 1029570, 527655065, -1768240, -906223756, -1100550, -564032346, 1266235, 648945979, -2834182, -1452519487, -3606200, -1848179042, -2942135, -1507845446, -3811828, -1953563480, -2908788, -1490755094, 304300, 155953880, -128903, -66062843, 4034765, 2067818788, 456460, 233935945, 2930777, 1502024466, 1177703, 603573291, -2666911, -1366793028, -1617369, -828902304, -2252592, -1154454363, 1126940, 577557232, 1176674, 603045928, -1074967, -550921047, 71096, 36436730, 1544179, 791392398, 2701928, 1384739255, 3687395, 1889791514, -289514, -148376049, -4006320, -2053240713, -3391741, -1738268713, 3397082, 1741005978, -2082410, -1067236015, 3694227, 1893292917, 2139042, 1096259940, 2855247, 1463315308, -323453, -165769801, 3030725, 1553247858, 4165644, 2134894331, 303555, 155572067, -320128, -164065737, -3652572, -1871944712, 2928433, 1500823165, -3698525, -1895495644, -3185999, -1632825850, 2943041, 1508309771, -3942328, -2020444786, -2096158, -1074281871, -3940422, -2019467960, 867824, 444760171, -1945215, -996923519, -2711718, -1389756635, 830280, 425518855, -276802, -141861143, 100235, 51370480, 3399074, 1742026878, -3258440, -1669951893, -1871079, -958928788, 1581316, 810425126, -3345528, -1714584531, -1445654, -740898293, -1372861, -703591850, 1113100, 570464226, 1673850, 857848841, -1079464, -553225762, -4064138, -2082872463, 2521846, 1292447153, 603796, 309445708, -2672019, -1369410880, -116259, -59582787, 305893, 156770293, 167496, 85841772, -1046859, -536515685, 2055067, 1053222716, 761290, 390161451, -3417705, -1751575274, 2469628, 1265685406, -3856547, -1976481987, -3138283, -1608371379, -389020, -199372916, -2156279, -1105093910, 1944480, 996546831, 1454416, 745388822, -821436, -420986301, -602826, -308948583, -172446, -88378649, 788703, 404210625, 1425073, 730350522, -1041361, -533697958, 879039, 450507863, -3341148, -1712339779, 915972, 469436042, 626783, 321226556, -315163, -161521172, -803323, -411703381, -1578061, -808756937, 4124770, 2113946389, -3382322, -1733441471, 4071154, 2086468166, 403894, 206995848, 3724329, 1908720205, -3970566, -2034916773, 1398455, 716708785, -2642882, -1354478155, 275768, 141331218, -2165461, -1109799688, -1368491, -701352223, -3839614, -1967803817, -4022687, -2061628808, 843874, 432485786, 3662432, 1876997966, 1852187, 949246630, -524811, -268965862, 391711, 200752055, 1047178, 536679173, -3379297, -1731891158, -4151501, -2127646038, 2932929, 1503127367, -294725, -151046689, -2419159, -1239820022, 2862208, 1466882824, -4104915, -2103770693, 2741731, 1405138310, 3386239, 1735448935, 3233627, 1657235220, -3597958, -1843955014, 17070, 8748382, -1242950, -637012406, -3112889, -1595356944, 2641904, 1353976930, -3282775, -1682423591, -1311761, -672278073, -1033361, -529597954, 2819973, 1445237368, 2377574, 1218507692, 1368612, 701414235, 158541, 81252330, 2447765, 1254480609, 3017964, 1546707840, -2259509, -1157999329, 3569830, 1829539401, 131113, 67195469, 3394311, 1739585839, -825110, -422869228, 2222515, 1139039888, -1872733, -959776463, -1430472, -733117512, -794398, -407129315, -1874454, -960658477, -3165836, -1622492304, 1312863, 672842849, 2553597, 1308719554, 2229223, 1142477741, 2042594, 1046830298, 3859121, 1977801163, 255574, 130981784, 1931514, 989901751, -4067201, -2084442252, -289157, -148193086, -2677309, -1372122007, 2350535, 1204650193, 1908806, 978263891, -3483979, -1785540727, -255360, -130872109, 3747856, 1920777803, -518949, -265961584, -2715685, -1391789724, -1144116, -586359939, -2041975, -1046513061, -3643993, -1867547971, 968386, 496298239, -2399316, -1229650476, 1824826, 935224105, -854689, -438028478, -3007494, -1541341961, 672351, 344580175, 750940, 384857071, 2137363, 1095399451, -1681557, -861798682, 3938267, 2018363522, -1589698, -814720905, -1449433, -742835032, 75663, 38777320, -1783126, -913852837, -3065391, -1571014198, -914846, -468858966, 1687035, 864606159, -2982141, -1528348538, -1144268, -586437839, 4105895, 2104272943, 1728144, 885674539, -3398031, -1741492341, 3526155, 1807155945, 900767, 461643473, -13828, -7086856, 893967, 458158470, -4177747, -2141097124, -3128905, -1603565150, 3817926, 1956688708, -3568941, -1829083789, -3558813, -1823893184, -3883889, -1990494773, 2048668, 1049943226, -3412190, -1748748834, -3032856, -1554339997, -4093936, -2098143951, -3664286, -1877948142, -303269, -155425492, -173, -88663, -831827, -426311693, 104699, 53658282, 157820, 80882817, 3050122, 1563188829, 3744961, 1919294114, 2225122, 1140375976, 2621046, 1343287196, 1206210, 618183141, -2155369, -1104627534, -2883940, -1478020483, -2148141, -1100923181, -4122115, -2112585700, 1082848, 554960063, -1366638, -700402559, 2260451, 1158482104, -1753196, -898513700, -894975, -458675070, -4011446, -2055867790, 1704391, 873501116, 3835025, 1965451952, -361139, -185083892, 1400514, 717764024, 3285081, 1683605417, 3534748, 1811559861, 800379, 410194580, 2003534, 1026812032, 2888634, 1480426160, -471633, -241712114, 3073666, 1575255139, 2870122, 1470938752, 1976031, 1012716732, -739868, -379182666, 817063, 418745137, 3361238, 1722635912, 2722087, 1395070751, -868519, -445116359, -3576395, -1832903967
};

// ================

static
int32_t streamlined_CT_fast_table[N << 1] = {
-3572223, -1830765815, 3765607, 1929875198, 3761513, 1927777021, -3201494, -1640767044, -601683, -308362795, 3542485, 1815525077, -2883726, -1477910808, 2682288, 1374673747, 2129892, 1091570561, -3145678, -1612161320, 3764867, 1929495947, -1005239, -515185417, -3201430, -1640734244, 557458, 285697463, -1221177, -625853735, -3370349, -1727305304, 3602218, 1846138265, 3182878, 1631226336, -4063053, -2082316400, 2740543, 1404529459, -3586446, -1838055109, 2663378, 1364982364, -3110818, -1594295555, 2101410, 1076973524, -1674615, -858240904, 3704823, 1898723372, 1159875, 594436433, -3524442, -1806278032, 394148, 202001019, 928749, 475984260, -434125, -222489248, 1095468, 561427818, -3506380, -1797021249, 676590, 346752664, 2071829, 1061813248, -4018989, -2059733581, -1335936, -684667771, 3241972, 1661512036, 2156050, 1104976547, -3227876, -1654287830, 3415069, 1750224323, 1759347, 901666090, 1714295, 878576921, -817536, -418987550, -3574466, -1831915353, 2453983, 1257667337, 3756790, 1925356481, -1935799, -992097815, 1460718, 748618600, -1716988, -879957084, -3950053, -2024403852, -642628, -329347125, -2897314, -1484874664, 3192354, 1636082790, -3585098, -1837364258, 556856, 285388938, 3870317, 1983539117, 2815639, 1443016191, 2917338, 1495136972, 1853806, 950076368, 2283733, 1170414139, 3345963, 1714807468, 1858416, 952438995, 3073009, 1574918427, 1753, 898413, -1935420, -991903578, 1277625, 654783359, -2659525, -1363007700, -1455890, -746144248, -2635473, -1350681039, 2660408, 1363460238, -1780227, -912367099, 3852015, 1974159335, -59148, -30313375, 2772600, 1420958686, 4183372, 2143979939, 1182243, 605900043, 87208, 44694137, -3222807, -1651689966, 636927, 326425360, -3965306, -2032221021, -3121440, -1599739335, -3956745, -2027833504, -2296397, -1176904444, -274060, -140455867, -3284915, -1683520342, -3716946, -1904936414, 2508980, 1285853323, -27812, -14253662, 822541, 421552614, 2028118, 1039411342, 1009365, 517299994, -2454145, -1257750362, 1937570, 993005454, -1979497, -1014493059, 1596822, 818371958, -3815725, -1955560694, -3956944, -2027935492, -3759465, -1926727420, 2811291, 1440787840, -1685153, -863641633, -3410568, -1747917558, -2983781, -1529189038, 2678278, 1372618620, -3768948, -1931587462, -1109516, -568627424, -3551006, -1819892093, 635956, 325927722, 4158088, 2131021878, -250446, -128353682, -2455377, -1258381762, 1528066, 783134478, -4146264, -2124962073, -1772588, -908452108, 482649, 247357819, 2192938, 1123881663, -1727088, -885133339, 1148858, 588790216, 2387513, 1223601433, -3611750, -1851023419, -2962264, -1518161567, -268456, -137583815, -3180456, -1629985060, -565603, -289871779, 3747250, 1920467227, 2296099, 1176751719, 169688, 86965173, 1239911, 635454918, -3838479, -1967222129, 2462444, 1262003603, 3195676, 1637785316, 2642980, 1354528380, -3334383, -1708872713, 1254190, 642772911, -12417, -6363718, -4166425, -2135294594, 2998219, 1536588520, 141835, 72690498, -3488383, -1787797779, -89301, -45766801, 2513018, 1287922800, 1987814, 1018755525, -1354892, -694382729, 613238, 314284737, -3197248, -1638590967, -1310261, -671509323, -2218467, -1136965286, 1736313, 889861155, -458740, -235104446, -1921994, -985022747, 235407, 120646188, 4040196, 2070602178, -3472069, -1779436847, -3250154, -1665705315, 2039144, 1045062172, -1879878, -963438279, 3258457, 1669960606, -818761, -419615363, -2178965, -1116720494, -2579253, -1321868265, -1623354, -831969619, 2105286, 1078959975, 1787943, 916321552, -2374402, -1216882040, -2033807, -1042326957, -2391089, -1225434135, 586241, 300448763, -1179613, -604552167, -2254727, -1155548552, 527981, 270590488, -2743411, -1405999311, 3482206, 1784632064, -1476985, -756955444, 1994046, 1021949428, -4182915, -2143745726, 2491325, 1276805128, -1393159, -713994583, -1300016, -666258756, 507927, 260312805, -1187885, -608791570, -2362063, -1210558298, -724804, -371462360, -1834526, -940195359, -1317678, -675310538, -3033742, -1554794072, -338420, -173440395, 2461387, 1261461890, 2647994, 1357098057, 3009748, 1542497137, 3035980, 1555941048, -2612853, -1339088280, 4148469, 2126092136, 621164, 318346816, 749577, 384158533, -4022750, -2061661095, 3901472, 1999506068, 3980599, 2040058690, 2569011, 1316619236, -1226661, -628664287, -1615530, -827959816, 1723229, 883155599, 2925816, 1499481951, 1665318, 853476187, 2028038, 1039370342, 3374250, 1729304568, 1163598, 596344473, -3369273, -1726753853, 1356448, 695180180, 3994671, 2047270596, -11879, -6087993, -2775755, -1422575624, -1370517, -702390549, 3020393, 1547952704, 2683270, 1375177022, 3363542, 1723816713, 214880, 110126092, -2778788, -1424130038, 545376, 279505433, -770441, -394851342, -3467665, -1777179795, 3105558, 1591599803, -1103344, -565464272, 2312838, 1185330464, 508145, 260424530, -553718, -283780712, -653275, -334803717, 860144, 440824168, 3430436, 1758099917, -459163, -235321234, 140244, 71875110, -1514152, -776003547, 348812, 178766299, -2185084, -1119856484, 3123762, 1600929361, -327848, -168022240, 2358373, 1208667171, -2193087, -1123958025, 1011223, 518252220, -3014420, -1544891539, -1716814, -879867909, -2354215, -1206536194, 2926054, 1499603926, -392707, -201262505, -3818627, -1957047970, -303005, -155290192, 3531229, 1809756372, -1922253, -985155484, -3974485, -2036925262, -3773731, -1934038751, -2236726, -1146323031, 1900052, 973777462, -781875, -400711272, 1744507, 894060583, 1054478, 540420426, -731434, -374860238, -3576395, -1832903967
};

static
int32_t streamlined_CT_inv_fast_table[N << 1] = {
1, 513, 1, 513, 3572223, 1830765815, 1, 513, 1, 513, 3572223, 1830765815, -3761513, -1927777021, 3201430, 1640734244, 3145678, 1612161320, 3572223, 1830765815, -3761513, -1927777021, -3765607, -1929875198, -3765607, -1929875198, 2883726, 1477910808, 3201494, 1640767044, 1, 513, 1, 513, 3572223, 1830765815, 1221177, 625853735, -2283733, -1170414139, -2815639, -1443016191, 3201430, 1640734244, 1221177, 625853735, -557458, -285697463, -2129892, -1091570561, 1335936, 684667771, -676590, -346752664, -3761513, -1927777021, 3201430, 1640734244, 3145678, 1612161320, 1005239, 515185417, -1460718, -748618600, -2453983, -1257667337, 2883726, 1477910808, -2129892, -1091570561, -2682288, -1374673747, -3542485, -1815525077, 1674615, 858240904, -2663378, -1364982364, 3572223, 1830765815, -3761513, -1927777021, -3765607, -1929875198, -557458, -285697463, 3585098, 1837364258, 642628, 329347125, 3145678, 1612161320, 1005239, 515185417, -3764867, -1929495947, -2682288, -1374673747, 434125, 222489248, 3524442, 1806278032, -3765607, -1929875198, 2883726, 1477910808, 3201494, 1640767044, -3764867, -1929495947, -1714295, -878576921, 3227876, 1654287830, 3201494, 1640767044, -3542485, -1815525077, 601683, 308362795, 601683, 308362795, 4063053, 2082316400, 3370349, 1727305304, 1, 513, 1, 513, 3572223, 1830765815, -1858416, -952438995, -1744507, -894060583, 2236726, 1146323031, -2283733, -1170414139, -1858416, -952438995, -3345963, -1714807468, -2156050, -1104976547, -3258457, -1669960606, 3250154, 1665705315, 1221177, 625853735, -2283733, -1170414139, -2815639, -1443016191, 3950053, 2024403852, -3374250, -1729304568, -2925816, -1499481951, 1335936, 684667771, -2156050, -1104976547, -3241972, -1661512036, -1159875, -594436433, -4158088, -2131021878, 1109516, 568627424, 3201430, 1640734244, 1221177, 625853735, -557458, -285697463, -3870317, -1983539117, 459163, 235321234, 653275, 334803717, -1460718, -748618600, 3950053, 2024403852, 1716988, 879957084, 3506380, 1797021249, 3334383, 1708872713, -2462444, -1262003603, -2129892, -1091570561, 1335936, 684667771, -676590, -346752664, 3574466, 1831915353, 2362063, 1210558298, 1300016, 666258756, 1674615, 858240904, -1159875, -594436433, -3704823, -1898723372, 3586446, 1838055109, 274060, 140455867, 3121440, 1599739335, -3761513, -1927777021, 3201430, 1640734244, 3145678, 1612161320, -1853806, -950076368, 2354215, 1206536194, -1011223, -518252220, 3585098, 1837364258, -3870317, -1983539117, -556856, -285388938, 4018989, 2059733581, 3197248, 1638590967, -1987814, -1018755525, 1005239, 515185417, -1460718, -748618600, -2453983, -1257667337, 1935799, 992097815, -621164, -318346816, -3035980, -1555941048, 434125, 222489248, 3506380, 1797021249, -1095468, -561427818, -2101410, -1076973524, 3815725, 1955560694, -1937570, -993005454, 2883726, 1477910808, -2129892, -1091570561, -2682288, -1374673747, -3192354, -1636082790, 2778788, 1424130038, -2683270, -1375177022, -1714295, -878576921, 3574466, 1831915353, 817536, 418987550, -928749, -475984260, 2962264, 1518161567, -1148858, -588790216, -3542485, -1815525077, 1674615, 858240904, -2663378, -1364982364, -1759347, -901666090, 2254727, 1155548552, 2391089, 1225434135, 4063053, 2082316400, 3586446, 1838055109, -2740543, -1404529459, -3182878, -1631226336, -3852015, -1974159335, 2635473, 1350681039, 3572223, 1830765815, -3761513, -1927777021, -3765607, -1929875198, -3345963, -1714807468, 1922253, 985155484, 3818627, 1957047970, -2815639, -1443016191, -1853806, -950076368, -2917338, -1495136972, -3241972, -1661512036, -235407, -120646188, -1736313, -889861155, -557458, -285697463, 3585098, 1837364258, 642628, 329347125, 1716988, 879957084, 1226661, 628664287, -3901472, -1999506068, -676590, -346752664, 4018989, 2059733581, -2071829, -1061813248, -3704823, -1898723372, 2983781, 1529189038, -2811291, -1440787840, 3145678, 1612161320, 1005239, 515185417, -3764867, -1929495947, -556856, -285388938, -2312838, -1185330464, 3467665, 1777179795, -2453983, -1257667337, 1935799, 992097815, -3756790, -1925356481, -1095468, -561427818, -169688, -86965173, 565603, 289871779, -2682288, -1374673747, 434125, 222489248, 3524442, 1806278032, 817536, 418987550, 4182915, 2143745726, -3482206, -1784632064, -2663378, -1364982364, -2101410, -1076973524, 3110818, 1594295555, -2740543, -1404529459, 3222807, 1651689966, -4183372, -2143979939, -3765607, -1929875198, 2883726, 1477910808, 3201494, 1640767044, -2917338, -1495136972, 327848, 168022240, -348812, -178766299, 642628, 329347125, -3192354, -1636082790, 2897314, 1484874664, -2071829, -1061813248, 3488383, 1787797779, 4166425, 2135294594, -3764867, -1929495947, -1714295, -878576921, 3227876, 1654287830, -3756790, -1925356481, -2461387, -1261461890, 1317678, 675310538, 3524442, 1806278032, -928749, -475984260, -394148, -202001019, 3110818, 1594295555, -2028118, -1039411342, -2508980, -1285853323, 3201494, 1640767044, -3542485, -1815525077, 601683, 308362795, 2897314, 1484874664, 2775755, 1422575624, -1356448, -695180180, 3227876, 1654287830, -1759347, -901666090, -3415069, -1750224323, -394148, -202001019, -482649, -247357819, -1528066, -783134478, 601683, 308362795, 4063053, 2082316400, 3370349, 1727305304, -3415069, -1750224323, -1787943, -916321552, 2579253, 1321868265, 3370349, 1727305304, -3182878, -1631226336, -3602218, -1846138265, -3602218, -1846138265, -1277625, -654783359, -3073009, -1574918427, -3576395, -1832903967
};

// ================

int main(void){

    hal_setup(CLOCK_BENCHMARK);
    hal_send_str("\n============ IGNORE OUTPUT BEFORE THIS LINE ============\n");

    int32_t poly1[N];
    int32_t poly1_extended[N << 1];
    int32_t poly_V[L][N];
    int32_t acc[K][N], row[L][N];

    sprintf(out, "\n============ Dilithium %d benchmark ============\n", DILITHIUM_MODE);
    hal_send_str(out);

    hal_send_str("\n============ Assembly benchmark ============\n");

    oldcount = hal_get_time();
    __asm_NTT(poly1, streamlined_CT_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_NTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_point_montmul(poly1, poly1, last_twist_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_point_montmul cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_extend(poly1_extended, poly1, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_extend cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_point_mul_pre(poly1, poly1, last_twist_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_point_mul_pre cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_iNTT(poly1, streamlined_CT_inv_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_iNTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_iNTT_negacyclic(poly1, streamlined_twiddle_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_iNTT_negacyclic (unused) cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_NTT_fast(poly1, streamlined_CT_fast_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_NTT_fast cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_point_montmul_fast(poly1, poly1, last_twist_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_point_montmul_fast cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_point_mul_pre_fast(poly1, poly1, last_twist_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_point_mul_pre_fast cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_iNTT_fast(poly1, streamlined_CT_inv_fast_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "__asm_iNTT_fast cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    hal_send_str("\n============ Dilithium operation benchmark ============\n");

    hal_send_str("\n======== Table 9 numbers ========\n");

    oldcount = hal_get_time();
    __asm_NTT(poly1, streamlined_CT_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "Constant-time Dilithium NTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_iNTT(poly1, streamlined_CT_inv_table, const_buff);
    __asm_point_mul_pre(poly1, poly1, last_twist_mont_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "Constant-time Dilithium iNTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_NTT_fast(poly1, streamlined_CT_fast_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "Variable-time Dilithium NTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();
    __asm_iNTT_fast(poly1, streamlined_CT_inv_fast_table, const_buff);
    __asm_point_mul_pre_fast(poly1, poly1, last_twist_table, const_buff);
    newcount = hal_get_time();
    sprintf(out, "Variable-time Dilithium iNTT cycles: %lld", newcount - oldcount);
    hal_send_str(out);

    hal_send_str("\n======== Table 13 numbers ========\n");

    oldcount = hal_get_time();

    for(size_t i = 0; i < L; i++){
        __asm_NTT(&poly_V[i][0], streamlined_CT_table, const_buff);
    }

    for(size_t i = 0; i < K; i++){
        __asm_InnerProd_L(&acc[i][0], &row[0][0], &poly_V[0][0]);
        __asm_iNTT(&acc[i][0], streamlined_CT_inv_table, const_buff);
        __asm_point_mul_pre(&acc[i][0], &acc[i][0], last_twist_mont_table, const_buff);
    }

    newcount = hal_get_time();
    sprintf(out, "Dilitihum %d matrix-vector mul cycles: %lld",
        DILITHIUM_MODE, newcount - oldcount);
    hal_send_str(out);

    oldcount = hal_get_time();

    for(size_t i = 0; i < L; i++){
        __asm_NTT_fast(&poly_V[i][0], streamlined_CT_table, const_buff);
    }

    for(size_t i = 0; i < K; i++){
        __asm_InnerProd_L_fast(&acc[i][0], &row[0][0], &poly_V[0][0]);
        __asm_iNTT_fast(&acc[i][0], streamlined_CT_inv_table, const_buff);
        __asm_point_mul_pre_fast(&acc[i][0], &acc[i][0], last_twist_table, const_buff);
    }

    newcount = hal_get_time();
    sprintf(out, "Dilitihum %d matrix-vector mul fast cycles: %lld",
        DILITHIUM_MODE, newcount - oldcount);
    hal_send_str(out);

}













